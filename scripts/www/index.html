<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4a55a2">
    <meta name="description" content="ç»¼åˆç®¡ç†å·¥å…· - æç¤ºè¯ã€æ–‡æ¡ˆå’Œä»»åŠ¡ç®¡ç†">
    <title>ç»¼åˆç®¡ç†å·¥å…·</title>
    <link rel="stylesheet" href="loading-styles.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 10px;
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
            touch-action: manipulation;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(45, 55, 72, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            text-align: center;
            color: #ffffff;
            margin-bottom: 24px;
            font-size: 28px;
            font-weight: 700;
            position: relative;
            padding-bottom: 15px;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, #4a55a2, #7895cb);
            border-radius: 2px;
        }

        /* ä¸»è¦å¯¼èˆªæ ‡ç­¾ */
        .main-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
            gap: 12px;
            flex-wrap: wrap;
        }

        .main-tab {
            padding: 12px 20px;
            border-radius: 8px;
            background: linear-gradient(135deg, #4a55a2 0%, #7895cb 100%);
            color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            font-size: 14px;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .main-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 85, 162, 0.3);
        }

        .main-tab.active {
            background: linear-gradient(135deg, #f9c74f 0%, #f8961e 100%);
            color: #1a1a2e;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* å­æ ‡ç­¾ */
        .sub-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: rgba(45, 55, 72, 0.7);
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .sub-tab {
            flex: 1;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: linear-gradient(135deg, #4a55a2 0%, #7895cb 100%);
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 12px;
        }

        .sub-tab.active {
            background: linear-gradient(135deg, #5a62d9 0%, #8a95db 100%);
            box-shadow: 0 0 20px rgba(90, 98, 217, 0.5);
            transform: scale(1.05);
        }

        /* è¿‡æ»¤å™¨åŒºåŸŸ */
        .filter-section {
            background: linear-gradient(135deg, rgba(45, 55, 72, 0.7), rgba(30, 41, 59, 0.7));
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .filter-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-input {
            flex: 1;
            min-width: 150px;
            padding: 10px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(45, 55, 72, 0.8);
            color: white;
            font-weight: 500;
        }

        .filter-input:focus {
            outline: none;
            border-color: #4a55a2;
            box-shadow: 0 0 0 2px rgba(74, 85, 162, 0.3);
        }

        .filter-select {
            min-width: 120px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(45, 55, 72, 0.8);
            color: white;
            font-weight: 500;
        }

        /* åˆ†ç±»æ ‡ç­¾ */
        .category-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .category-tag {
            background: linear-gradient(135deg, #4a55a2 0%, #7895cb 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .category-tag:hover {
            background: linear-gradient(135deg, #3a4582 0%, #6785bb 100%);
            transform: translateY(-2px);
        }

        .category-tag.active {
            background: linear-gradient(135deg, #5a62d9 0%, #8a95db 100%);
            transform: scale(1.05);
        }

        /* é¡¹ç›®åˆ—è¡¨ */
        .item-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .item {
            background: linear-gradient(135deg, rgba(45, 55, 72, 0.7), rgba(30, 41, 59, 0.7));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            animation: fadeIn 0.5s ease;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 85, 162, 0.3);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .item-title {
            flex: 1;
            margin: 0;
            padding-right: 12px;
            font-size: 16px;
            font-weight: 600;
            color: white;
        }

        .item-category {
            background: linear-gradient(135deg, #4a55a2 0%, #7895cb 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: normal;
            white-space: nowrap;
        }

        .item-content {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .item-date {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #4a55a2 0%, #7895cb 100%);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 85, 162, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%);
        }

        .btn-danger:hover {
            box-shadow: 0 4px 12px rgba(211, 47, 47, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .star {
            color: #f9c74f;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .star:hover {
            transform: scale(1.2);
        }

        /* ä»»åŠ¡çŠ¶æ€æ ·å¼ */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fed7d7;
            color: #c53030;
        }

        .status-progress {
            background: #c6f6d5;
            color: #38a169;
        }

        .status-completed {
            background: #feebc8;
            color: #d69e2e;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(45, 55, 72, 0.95), rgba(30, 41, 59, 0.95));
            margin: 5% auto;
            padding: 24px;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .close {
            color: white;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }

        .close:hover {
            opacity: 1;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            font-size: 14px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(45, 55, 72, 0.8);
            color: white;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #4a55a2;
            box-shadow: 0 0 0 2px rgba(74, 85, 162, 0.3);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.7);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-text {
            font-size: 16px;
            margin-bottom: 20px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
                border-radius: 12px;
            }

            h1 {
                font-size: 24px;
            }

            .main-tabs {
                gap: 8px;
                margin-bottom: 20px;
            }

            .main-tab {
                padding: 10px 16px;
                font-size: 13px;
            }

            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-input, .filter-select {
                min-width: unset;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 20px;
            }

            .form-actions {
                flex-direction: column;
            }

            .item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .item-actions {
                align-self: flex-end;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç»¼åˆç®¡ç†å·¥å…·</h1>
        
        <!-- ä¸»è¦å¯¼èˆªæ ‡ç­¾ -->
        <div class="main-tabs">
            <button class="main-tab active" data-section="prompts">æç¤ºè¯ç®¡ç†</button>
            <button class="main-tab" data-section="copies">æ–‡æ¡ˆç®¡ç†</button>
            <button class="main-tab" data-section="tasks">ä»»åŠ¡ç®¡ç†</button>
        </div>

        <!-- æç¤ºè¯ç®¡ç†åŒºåŸŸ -->
        <div id="prompts-section" class="content-section active">
            <div class="sub-tabs">
                <button class="sub-tab active" data-view="all">å…¨éƒ¨</button>
                <button class="sub-tab" data-view="starred">æ˜Ÿæ ‡</button>
            </div>

            <div class="filter-section">
                <div class="filter-row">
                    <input type="text" class="filter-input" id="promptSearch" placeholder="æœç´¢æç¤ºè¯...">
                    <select class="filter-select" id="promptSort">
                        <option value="date">æŒ‰æ—¥æœŸæ’åº</option>
                        <option value="title">æŒ‰æ ‡é¢˜æ’åº</option>
                        <option value="category">æŒ‰åˆ†ç±»æ’åº</option>
                    </select>
                    <button class="btn" onclick="openPromptModal()">æ·»åŠ æç¤ºè¯</button>
                </div>
                <div class="category-list" id="promptCategories"></div>
            </div>

            <div class="item-list" id="promptList"></div>
            <div class="empty-state" id="promptEmpty" style="display: none;">
                <div class="empty-icon">ğŸ“</div>
                <div class="empty-text">æš‚æ— æç¤ºè¯</div>
                <button class="btn" onclick="openPromptModal()">æ·»åŠ ç¬¬ä¸€ä¸ªæç¤ºè¯</button>
            </div>
        </div>

        <!-- æ–‡æ¡ˆç®¡ç†åŒºåŸŸ -->
        <div id="copies-section" class="content-section">
            <div class="sub-tabs">
                <button class="sub-tab active" data-view="all">å…¨éƒ¨</button>
                <button class="sub-tab" data-view="starred">æ˜Ÿæ ‡</button>
            </div>

            <div class="filter-section">
                <div class="filter-row">
                    <input type="text" class="filter-input" id="copySearch" placeholder="æœç´¢æ–‡æ¡ˆ...">
                    <select class="filter-select" id="copySort">
                        <option value="date">æŒ‰æ—¥æœŸæ’åº</option>
                        <option value="title">æŒ‰æ ‡é¢˜æ’åº</option>
                        <option value="category">æŒ‰åˆ†ç±»æ’åº</option>
                    </select>
                    <button class="btn" onclick="openCopyModal()">æ·»åŠ æ–‡æ¡ˆ</button>
                </div>
                <div class="category-list" id="copyCategories"></div>
            </div>

            <div class="item-list" id="copyList"></div>
            <div class="empty-state" id="copyEmpty" style="display: none;">
                <div class="empty-icon">ğŸ“„</div>
                <div class="empty-text">æš‚æ— æ–‡æ¡ˆ</div>
                <button class="btn" onclick="openCopyModal()">æ·»åŠ ç¬¬ä¸€ä¸ªæ–‡æ¡ˆ</button>
            </div>
        </div>

        <!-- ä»»åŠ¡ç®¡ç†åŒºåŸŸ -->
        <div id="tasks-section" class="content-section">
            <div class="sub-tabs">
                <button class="sub-tab active" data-view="all">å…¨éƒ¨</button>
                <button class="sub-tab" data-view="pending">å¾…å¤„ç†</button>
                <button class="sub-tab" data-view="in-progress">è¿›è¡Œä¸­</button>
                <button class="sub-tab" data-view="completed">å·²å®Œæˆ</button>
                <button class="sub-tab" data-view="starred">æ˜Ÿæ ‡</button>
            </div>

            <div class="filter-section">
                <div class="filter-row">
                    <input type="text" class="filter-input" id="taskSearch" placeholder="æœç´¢ä»»åŠ¡...">
                    <select class="filter-select" id="taskSort">
                        <option value="createdAt">æŒ‰åˆ›å»ºæ—¶é—´</option>
                        <option value="updatedAt">æŒ‰æ›´æ–°æ—¶é—´</option>
                        <option value="title">æŒ‰æ ‡é¢˜æ’åº</option>
                        <option value="category">æŒ‰åˆ†ç±»æ’åº</option>
                    </select>
                    <button class="btn" onclick="openTaskModal()">æ·»åŠ ä»»åŠ¡</button>
                </div>
                <div class="category-list" id="taskCategories"></div>
            </div>

            <div class="item-list" id="taskList"></div>
            <div class="empty-state" id="taskEmpty" style="display: none;">
                <div class="empty-icon">âœ…</div>
                <div class="empty-text">æš‚æ— ä»»åŠ¡</div>
                <button class="btn" onclick="openTaskModal()">æ·»åŠ ç¬¬ä¸€ä¸ªä»»åŠ¡</button>
            </div>
        </div>
    </div>

    <!-- æç¤ºè¯æ¨¡æ€æ¡† -->
    <div id="promptModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="promptModalTitle">æ·»åŠ æç¤ºè¯</h2>
                <span class="close" onclick="closePromptModal()">&times;</span>
            </div>
            <form id="promptForm">
                <div class="form-group">
                    <label class="form-label">æ ‡é¢˜</label>
                    <input type="text" class="form-input" id="promptTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">å†…å®¹</label>
                    <textarea class="form-textarea" id="promptContent" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">åˆ†ç±»</label>
                    <select class="form-select" id="promptCategory" required>
                        <option value="">é€‰æ‹©åˆ†ç±»</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closePromptModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ–‡æ¡ˆæ¨¡æ€æ¡† -->
    <div id="copyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="copyModalTitle">æ·»åŠ æ–‡æ¡ˆ</h2>
                <span class="close" onclick="closeCopyModal()">&times;</span>
            </div>
            <form id="copyForm">
                <div class="form-group">
                    <label class="form-label">æ ‡é¢˜</label>
                    <input type="text" class="form-input" id="copyTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">å†…å®¹</label>
                    <textarea class="form-textarea" id="copyContent" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">åˆ†ç±»</label>
                    <select class="form-select" id="copyCategory" required>
                        <option value="">é€‰æ‹©åˆ†ç±»</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeCopyModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ä»»åŠ¡æ¨¡æ€æ¡† -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="taskModalTitle">æ·»åŠ ä»»åŠ¡</h2>
                <span class="close" onclick="closeTaskModal()">&times;</span>
            </div>
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label">æ ‡é¢˜</label>
                    <input type="text" class="form-input" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">æè¿°</label>
                    <textarea class="form-textarea" id="taskDescription"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">åˆ†ç±»</label>
                    <select class="form-select" id="taskCategory" required>
                        <option value="">é€‰æ‹©åˆ†ç±»</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">çŠ¶æ€</label>
                    <select class="form-select" id="taskStatus" required>
                        <option value="pending">å¾…å¤„ç†</option>
                        <option value="in-progress">è¿›è¡Œä¸­</option>
                        <option value="completed">å·²å®Œæˆ</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeTaskModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨é”®å
        const STORAGE_KEYS = {
            prompts: {
                categories: 'integratedManager_prompts_categories',
                data: 'integratedManager_prompts_data'
            },
            copies: {
                categories: 'integratedManager_copies_categories',
                data: 'integratedManager_copies_data'
            },
            tasks: {
                categories: 'integratedManager_tasks_categories',
                data: 'integratedManager_tasks_data'
            }
        };

        // é»˜è®¤åˆ†ç±»
        const DEFAULT_CATEGORIES = ['å†™ä½œ', 'ç¼–ç¨‹', 'è®¾è®¡', 'è¥é”€', 'å­¦ä¹ ', 'å·¥ä½œ', 'ç”Ÿæ´»'];

        // åˆå§‹åŒ–æ•°æ®
        let prompts = JSON.parse(localStorage.getItem(STORAGE_KEYS.prompts.data)) || [];
        let copies = JSON.parse(localStorage.getItem(STORAGE_KEYS.copies.data)) || [];
        let tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks.data)) || [];

        let promptCategories = JSON.parse(localStorage.getItem(STORAGE_KEYS.prompts.categories)) || DEFAULT_CATEGORIES.slice();
        let copyCategories = JSON.parse(localStorage.getItem(STORAGE_KEYS.copies.categories)) || DEFAULT_CATEGORIES.slice();
        let taskCategories = JSON.parse(localStorage.getItem(STORAGE_KEYS.tasks.categories)) || DEFAULT_CATEGORIES.slice();

        // å½“å‰é€‰ä¸­çš„åˆ†ç±»å’Œè§†å›¾
        let selectedPromptCategories = [];
        let selectedCopyCategories = [];
        let selectedTaskCategories = [];
        let currentPromptView = 'all';
        let currentCopyView = 'all';
        let currentTaskView = 'all';

        // å½“å‰ç¼–è¾‘çš„é¡¹ç›®ID
        let editingPromptId = null;
        let editingCopyId = null;
        let editingTaskId = null;

        // DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupEventListeners();
            renderAllCategories();
            renderAllLists();
        }

        function setupEventListeners() {
            // ä¸»æ ‡ç­¾åˆ‡æ¢
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchMainTab(this.dataset.section);
                });
            });

            // å­æ ‡ç­¾åˆ‡æ¢
            document.querySelectorAll('.sub-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchSubTab(this.dataset.view);
                });
            });

            // è¡¨å•æäº¤äº‹ä»¶
            document.getElementById('promptForm').addEventListener('submit', savePrompt);
            document.getElementById('copyForm').addEventListener('submit', saveCopy);
            document.getElementById('taskForm').addEventListener('submit', saveTask);

            // æœç´¢å’Œæ’åºäº‹ä»¶
            document.getElementById('promptSearch').addEventListener('input', renderPromptList);
            document.getElementById('copySearch').addEventListener('input', renderCopyList);
            document.getElementById('taskSearch').addEventListener('input', renderTaskList);

            document.getElementById('promptSort').addEventListener('change', renderPromptList);
            document.getElementById('copySort').addEventListener('change', renderCopyList);
            document.getElementById('taskSort').addEventListener('change', renderTaskList);

            // æ¨¡æ€æ¡†å…³é—­äº‹ä»¶
            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });
        }

        function switchMainTab(section) {
            // æ›´æ–°ä¸»æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-section="${section}"]`).classList.add('active');

            // æ›´æ–°å†…å®¹åŒºåŸŸ
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`${section}-section`).classList.add('active');

            // é‡ç½®å­æ ‡ç­¾
            const activeSection = document.getElementById(`${section}-section`);
            activeSection.querySelectorAll('.sub-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            activeSection.querySelector('.sub-tab').classList.add('active');

            // é‡ç½®è§†å›¾çŠ¶æ€
            if (section === 'prompts') currentPromptView = 'all';
            if (section === 'copies') currentCopyView = 'all';
            if (section === 'tasks') currentTaskView = 'all';

            renderAllLists();
        }

        function switchSubTab(view) {
            const activeSection = document.querySelector('.content-section.active');
            activeSection.querySelectorAll('.sub-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            activeSection.querySelector(`[data-view="${view}"]`).classList.add('active');

            // æ›´æ–°å¯¹åº”çš„è§†å›¾çŠ¶æ€
            if (activeSection.id === 'prompts-section') currentPromptView = view;
            if (activeSection.id === 'copies-section') currentCopyView = view;
            if (activeSection.id === 'tasks-section') currentTaskView = view;

            renderAllLists();
        }

        // æ¸²æŸ“æ‰€æœ‰åˆ†ç±»
        function renderAllCategories() {
            renderCategoryList('promptCategories', promptCategories, selectedPromptCategories, 'prompt');
            renderCategoryList('copyCategories', copyCategories, selectedCopyCategories, 'copy');
            renderCategoryList('taskCategories', taskCategories, selectedTaskCategories, 'task');
        }

        function renderCategoryList(containerId, categories, selectedCategories, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            categories.forEach(category => {
                const tag = document.createElement('div');
                tag.className = 'category-tag';
                if (selectedCategories.includes(category)) {
                    tag.classList.add('active');
                }
                tag.textContent = category;
                tag.onclick = () => toggleCategory(type, category);
                container.appendChild(tag);
            });
        }

        function toggleCategory(type, category) {
            let selectedCategories, setKey;
            
            switch(type) {
                case 'prompt':
                    selectedCategories = selectedPromptCategories;
                    setKey = 'selectedPromptCategories';
                    break;
                case 'copy':
                    selectedCategories = selectedCopyCategories;
                    setKey = 'selectedCopyCategories';
                    break;
                case 'task':
                    selectedCategories = selectedTaskCategories;
                    setKey = 'selectedTaskCategories';
                    break;
            }

            const index = selectedCategories.indexOf(category);
            if (index > -1) {
                selectedCategories.splice(index, 1);
            } else {
                selectedCategories.push(category);
            }

            renderAllLists();
        }

        // æ¸²æŸ“æ‰€æœ‰åˆ—è¡¨
        function renderAllLists() {
            renderPromptList();
            renderCopyList();
            renderTaskList();
        }

        function renderPromptList() {
            const listContainer = document.getElementById('promptList');
            const emptyContainer = document.getElementById('promptEmpty');
            const searchInput = document.getElementById('promptSearch');
            const sortSelect = document.getElementById('promptSort');

            let filteredPrompts = filterItems(prompts, selectedPromptCategories, currentPromptView, searchInput.value, 'prompt');
            filteredPrompts = sortItems(filteredPrompts, sortSelect.value, 'prompt');

            if (filteredPrompts.length === 0) {
                listContainer.style.display = 'none';
                emptyContainer.style.display = 'block';
            } else {
                listContainer.style.display = 'flex';
                emptyContainer.style.display = 'none';
                
                listContainer.innerHTML = '';
                filteredPrompts.forEach(prompt => {
                    const item = createPromptItem(prompt);
                    listContainer.appendChild(item);
                });
            }
        }

        function renderCopyList() {
            const listContainer = document.getElementById('copyList');
            const emptyContainer = document.getElementById('copyEmpty');
            const searchInput = document.getElementById('copySearch');
            const sortSelect = document.getElementById('copySort');

            let filteredCopies = filterItems(copies, selectedCopyCategories, currentCopyView, searchInput.value, 'copy');
            filteredCopies = sortItems(filteredCopies, sortSelect.value, 'copy');

            if (filteredCopies.length === 0) {
                listContainer.style.display = 'none';
                emptyContainer.style.display = 'block';
            } else {
                listContainer.style.display = 'flex';
                emptyContainer.style.display = 'none';
                
                listContainer.innerHTML = '';
                filteredCopies.forEach(copy => {
                    const item = createCopyItem(copy);
                    listContainer.appendChild(item);
                });
            }
        }

        function renderTaskList() {
            const listContainer = document.getElementById('taskList');
            const emptyContainer = document.getElementById('taskEmpty');
            const searchInput = document.getElementById('taskSearch');
            const sortSelect = document.getElementById('taskSort');

            let filteredTasks = filterTasks(tasks, selectedTaskCategories, currentTaskView, searchInput.value);
            filteredTasks = sortTasks(filteredTasks, sortSelect.value);

            if (filteredTasks.length === 0) {
                listContainer.style.display = 'none';
                emptyContainer.style.display = 'block';
            } else {
                listContainer.style.display = 'flex';
                emptyContainer.style.display = 'none';
                
                listContainer.innerHTML = '';
                filteredTasks.forEach(task => {
                    const item = createTaskItem(task);
                    listContainer.appendChild(item);
                });
            }
        }

        function filterItems(items, selectedCategories, view, searchTerm, type) {
            return items.filter(item => {
                // è§†å›¾è¿‡æ»¤
                if (view === 'starred' && !item.starred) return false;
                
                // åˆ†ç±»è¿‡æ»¤
                if (selectedCategories.length > 0 && !selectedCategories.includes(item.category)) return false;
                
                // æœç´¢è¿‡æ»¤
                if (searchTerm) {
                    const searchText = searchTerm.toLowerCase();
                    return item.title.toLowerCase().includes(searchText) || 
                           item.content.toLowerCase().includes(searchText);
                }
                
                return true;
            });
        }

        function filterTasks(items, selectedCategories, view, searchTerm) {
            return items.filter(item => {
                // è§†å›¾è¿‡æ»¤
                if (view !== 'all' && view !== 'starred' && item.status !== view) return false;
                if (view === 'starred' && !item.starred) return false;
                
                // åˆ†ç±»è¿‡æ»¤
                if (selectedCategories.length > 0 && !selectedCategories.includes(item.category)) return false;
                
                // æœç´¢è¿‡æ»¤
                if (searchTerm) {
                    const searchText = searchTerm.toLowerCase();
                    return item.title.toLowerCase().includes(searchText) || 
                           item.description.toLowerCase().includes(searchText);
                }
                
                return true;
            });
        }

        function sortItems(items, sortBy, type) {
            return items.sort((a, b) => {
                switch(sortBy) {
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'category':
                        return a.category.localeCompare(b.category);
                    case 'date':
                    default:
                        return new Date(b.date) - new Date(a.date);
                }
            });
        }

        function sortTasks(items, sortBy) {
            return items.sort((a, b) => {
                switch(sortBy) {
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'category':
                        return a.category.localeCompare(b.category);
                    case 'updatedAt':
                        return new Date(b.updatedAt) - new Date(a.updatedAt);
                    case 'createdAt':
                    default:
                        return new Date(b.createdAt) - new Date(a.createdAt);
                }
            });
        }

        function createPromptItem(prompt) {
            const item = document.createElement('div');
            item.className = 'item';
            item.innerHTML = `
                <div class="item-header">
                    <h3 class="item-title">${prompt.title}</h3>
                    <span class="item-category">${prompt.category}</span>
                </div>
                <div class="item-content">${prompt.content}</div>
                <div class="item-footer">
                    <span class="item-date">${formatDate(prompt.date)}</span>
                    <div class="item-actions">
                        <span class="star" onclick="togglePromptStar(${prompt.id})">${prompt.starred ? 'â­' : 'â˜†'}</span>
                        <button class="btn" onclick="editPrompt(${prompt.id})">ç¼–è¾‘</button>
                        <button class="btn btn-danger" onclick="deletePrompt(${prompt.id})">åˆ é™¤</button>
                    </div>
                </div>
            `;
            return item;
        }

        function createCopyItem(copy) {
            const item = document.createElement('div');
            item.className = 'item';
            item.innerHTML = `
                <div class="item-header">
                    <h3 class="item-title">${copy.title}</h3>
                    <span class="item-category">${copy.category}</span>
                </div>
                <div class="item-content">${copy.content}</div>
                <div class="item-footer">
                    <span class="item-date">${formatDate(copy.date)}</span>
                    <div class="item-actions">
                        <span class="star" onclick="toggleCopyStar(${copy.id})">${copy.starred ? 'â­' : 'â˜†'}</span>
                        <button class="btn" onclick="editCopy(${copy.id})">ç¼–è¾‘</button>
                        <button class="btn btn-danger" onclick="deleteCopy(${copy.id})">åˆ é™¤</button>
                    </div>
                </div>
            `;
            return item;
        }

        function createTaskItem(task) {
            const item = document.createElement('div');
            item.className = 'item';
            const statusClass = `status-${task.status}`;
            const statusText = getStatusText(task.status);
            
            item.innerHTML = `
                <div class="item-header">
                    <h3 class="item-title">${task.title}</h3>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <span class="status-badge ${statusClass}">${statusText}</span>
                        <span class="item-category">${task.category}</span>
                    </div>
                </div>
                <div class="item-content">${task.description || 'æ— æè¿°'}</div>
                <div class="item-footer">
                    <span class="item-date">æ›´æ–°äº ${formatDate(task.updatedAt)}</span>
                    <div class="item-actions">
                        <span class="star" onclick="toggleTaskStar('${task.id}')">${task.starred ? 'â­' : 'â˜†'}</span>
                        <button class="btn btn-success" onclick="updateTaskStatus('${task.id}')">${getStatusButtonText(task.status)}</button>
                        <button class="btn" onclick="editTask('${task.id}')">ç¼–è¾‘</button>
                        <button class="btn btn-danger" onclick="deleteTask('${task.id}')">åˆ é™¤</button>
                    </div>
                </div>
            `;
            return item;
        }

        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'å¾…å¤„ç†';
                case 'in-progress': return 'è¿›è¡Œä¸­';
                case 'completed': return 'å·²å®Œæˆ';
                default: return status;
            }
        }

        function getStatusButtonText(status) {
            switch(status) {
                case 'pending': return 'å¼€å§‹';
                case 'in-progress': return 'å®Œæˆ';
                case 'completed': return 'é‡æ–°å¼€å§‹';
                default: return 'æ“ä½œ';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) return 'ä»Šå¤©';
            if (diffDays === 2) return 'æ˜¨å¤©';
            if (diffDays <= 7) return `${diffDays - 1}å¤©å‰`;
            
            return date.toLocaleDateString('zh-CN');
        }

        // æç¤ºè¯ç›¸å…³å‡½æ•°
        function openPromptModal() {
            editingPromptId = null;
            document.getElementById('promptModalTitle').textContent = 'æ·»åŠ æç¤ºè¯';
            document.getElementById('promptForm').reset();
            populateCategorySelect('promptCategory', promptCategories);
            document.getElementById('promptModal').style.display = 'block';
        }

        function editPrompt(id) {
            editingPromptId = id;
            const prompt = prompts.find(p => p.id === id);
            if (!prompt) return;

            document.getElementById('promptModalTitle').textContent = 'ç¼–è¾‘æç¤ºè¯';
            document.getElementById('promptTitle').value = prompt.title;
            document.getElementById('promptContent').value = prompt.content;
            populateCategorySelect('promptCategory', promptCategories, prompt.category);
            document.getElementById('promptModal').style.display = 'block';
        }

        function closePromptModal() {
            document.getElementById('promptModal').style.display = 'none';
        }

        function savePrompt(e) {
            e.preventDefault();
            
            const title = document.getElementById('promptTitle').value.trim();
            const content = document.getElementById('promptContent').value.trim();
            const category = document.getElementById('promptCategory').value;

            if (!title || !content || !category) return;

            const now = new Date().toISOString();

            if (editingPromptId) {
                // ç¼–è¾‘ç°æœ‰æç¤ºè¯
                const index = prompts.findIndex(p => p.id === editingPromptId);
                if (index !== -1) {
                    prompts[index] = {
                        ...prompts[index],
                        title,
                        content,
                        category,
                        date: now
                    };
                }
            } else {
                // æ·»åŠ æ–°æç¤ºè¯
                const newPrompt = {
                    id: Date.now(),
                    title,
                    content,
                    category,
                    date: now,
                    starred: false
                };
                prompts.push(newPrompt);
            }

            saveToStorage(STORAGE_KEYS.prompts.data, prompts);
            closePromptModal();
            renderPromptList();
        }

        function togglePromptStar(id) {
            const prompt = prompts.find(p => p.id === id);
            if (prompt) {
                prompt.starred = !prompt.starred;
                saveToStorage(STORAGE_KEYS.prompts.data, prompts);
                renderPromptList();
            }
        }

        function deletePrompt(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæç¤ºè¯å—ï¼Ÿ')) {
                prompts = prompts.filter(p => p.id !== id);
                saveToStorage(STORAGE_KEYS.prompts.data, prompts);
                renderPromptList();
            }
        }

        // æ–‡æ¡ˆç›¸å…³å‡½æ•°
        function openCopyModal() {
            editingCopyId = null;
            document.getElementById('copyModalTitle').textContent = 'æ·»åŠ æ–‡æ¡ˆ';
            document.getElementById('copyForm').reset();
            populateCategorySelect('copyCategory', copyCategories);
            document.getElementById('copyModal').style.display = 'block';
        }

        function editCopy(id) {
            editingCopyId = id;
            const copy = copies.find(c => c.id === id);
            if (!copy) return;

            document.getElementById('copyModalTitle').textContent = 'ç¼–è¾‘æ–‡æ¡ˆ';
            document.getElementById('copyTitle').value = copy.title;
            document.getElementById('copyContent').value = copy.content;
            populateCategorySelect('copyCategory', copyCategories, copy.category);
            document.getElementById('copyModal').style.display = 'block';
        }

        function closeCopyModal() {
            document.getElementById('copyModal').style.display = 'none';
        }

        function saveCopy(e) {
            e.preventDefault();
            
            const title = document.getElementById('copyTitle').value.trim();
            const content = document.getElementById('copyContent').value.trim();
            const category = document.getElementById('copyCategory').value;

            if (!title || !content || !category) return;

            const now = new Date().toISOString();

            if (editingCopyId) {
                // ç¼–è¾‘ç°æœ‰æ–‡æ¡ˆ
                const index = copies.findIndex(c => c.id === editingCopyId);
                if (index !== -1) {
                    copies[index] = {
                        ...copies[index],
                        title,
                        content,
                        category,
                        date: now
                    };
                }
            } else {
                // æ·»åŠ æ–°æ–‡æ¡ˆ
                const newCopy = {
                    id: Date.now(),
                    title,
                    content,
                    category,
                    date: now,
                    starred: false
                };
                copies.push(newCopy);
            }

            saveToStorage(STORAGE_KEYS.copies.data, copies);
            closeCopyModal();
            renderCopyList();
        }

        function toggleCopyStar(id) {
            const copy = copies.find(c => c.id === id);
            if (copy) {
                copy.starred = !copy.starred;
                saveToStorage(STORAGE_KEYS.copies.data, copies);
                renderCopyList();
            }
        }

        function deleteCopy(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡æ¡ˆå—ï¼Ÿ')) {
                copies = copies.filter(c => c.id !== id);
                saveToStorage(STORAGE_KEYS.copies.data, copies);
                renderCopyList();
            }
        }

        // ä»»åŠ¡ç›¸å…³å‡½æ•°
        function openTaskModal() {
            editingTaskId = null;
            document.getElementById('taskModalTitle').textContent = 'æ·»åŠ ä»»åŠ¡';
            document.getElementById('taskForm').reset();
            populateCategorySelect('taskCategory', taskCategories);
            document.getElementById('taskModal').style.display = 'block';
        }

        function editTask(id) {
            editingTaskId = id;
            const task = tasks.find(t => t.id === id);
            if (!task) return;

            document.getElementById('taskModalTitle').textContent = 'ç¼–è¾‘ä»»åŠ¡';
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description;
            populateCategorySelect('taskCategory', taskCategories, task.category);
            document.getElementById('taskStatus').value = task.status;
            document.getElementById('taskModal').style.display = 'block';
        }

        function closeTaskModal() {
            document.getElementById('taskModal').style.display = 'none';
        }

        function saveTask(e) {
            e.preventDefault();
            
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            const category = document.getElementById('taskCategory').value;
            const status = document.getElementById('taskStatus').value;

            if (!title || !category || !status) return;

            const now = new Date().toISOString();

            if (editingTaskId) {
                // ç¼–è¾‘ç°æœ‰ä»»åŠ¡
                const index = tasks.findIndex(t => t.id === editingTaskId);
                if (index !== -1) {
                    tasks[index] = {
                        ...tasks[index],
                        title,
                        description,
                        category,
                        status,
                        updatedAt: now
                    };
                }
            } else {
                // æ·»åŠ æ–°ä»»åŠ¡
                const newTask = {
                    id: Date.now().toString(),
                    title,
                    description,
                    category,
                    status,
                    createdAt: now,
                    updatedAt: now,
                    starred: false,
                    isDeleted: false
                };
                tasks.push(newTask);
            }

            saveToStorage(STORAGE_KEYS.tasks.data, tasks);
            closeTaskModal();
            renderTaskList();
        }

        function toggleTaskStar(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.starred = !task.starred;
                task.updatedAt = new Date().toISOString();
                saveToStorage(STORAGE_KEYS.tasks.data, tasks);
                renderTaskList();
            }
        }

        function updateTaskStatus(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;

            // å¾ªç¯çŠ¶æ€ï¼špending -> in-progress -> completed -> pending
            const statusFlow = ['pending', 'in-progress', 'completed'];
            const currentIndex = statusFlow.indexOf(task.status);
            const nextIndex = (currentIndex + 1) % statusFlow.length;
            
            task.status = statusFlow[nextIndex];
            task.updatedAt = new Date().toISOString();
            
            saveToStorage(STORAGE_KEYS.tasks.data, tasks);
            renderTaskList();
        }

        function deleteTask(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) {
                tasks = tasks.filter(t => t.id !== id);
                saveToStorage(STORAGE_KEYS.tasks.data, tasks);
                renderTaskList();
            }
        }

        // å·¥å…·å‡½æ•°
        function populateCategorySelect(selectId, categories, selectedCategory = '') {
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">é€‰æ‹©åˆ†ç±»</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                if (category === selectedCategory) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        function saveToStorage(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }
    </script>
</body>
</html>